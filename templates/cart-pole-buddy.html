<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart-Pole LQR Tutorial</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 columns */
            grid-template-rows: auto; /* Dynamic rows */
            gap: 20px; /* Spacing between grid items */
        }

        /* Define grid areas */
        .title {
            grid-column: 1 / -1; /* Spans all 4 columns */
            text-align: center;
        }

        .introduction {
            grid-column: 1 / 3; /* Spans first two columns */
            grid-row: 2;
        }

        .equations {
            grid-column: 3 / 5; /* Spans last two columns */
            grid-row: 2;
        }

        .parameters {
            grid-column: 1 / 3; /* Spans first two columns */
            grid-row: 3;
        }

        .results {
            grid-column: 3 / 5; /* Spans last two columns */
            grid-row: 3;
        }

        .trajectory {
            grid-column: 1 / 5; /* Spans all 4 columns */
            grid-row: 4;
        }

        /* General styles */
        .container {
            margin-bottom: 15px;
        }

        .widget {
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #f9f9f9;
        }

        svg {
            width: 100%;
            height: 300px;
            border: 1px solid #ccc;
        }

        input[type="number"], textarea {
            width: 100%;
            box-sizing: border-box;
        }

        .results div {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="title">
        <h1>Cart-Pole LQR Tutorial</h1>
    </div>

    <div class="introduction widget">
        <h2>Introduction</h2>
        <p>
            The cart-pole system is a classic problem in control theory and reinforcement learning. Here, we will solve it using Linear Quadratic Regulator (LQR) control.
        </p>
    </div>

    <div class="equations widget">
        <h2>Equations of Motion</h2>
        <p>
            The system dynamics are described by:
        </p>
        <div style="text-align: left;">
            \[
            \begin{aligned}
                \dot{x} &= v, \\
                \dot{v} &= \frac{F + m_p \sin(\theta) (l \dot{\theta}^2 + g \cos(\theta))}{m_c + m_p \sin^2(\theta)}, \\
                \dot{\theta} &= \omega, \\
                \dot{\omega} &= \frac{-F \cos(\theta) - m_p l \dot{\theta}^2 \cos(\theta) \sin(\theta) - (m_c + m_p) g \sin(\theta)}{l (m_c + m_p \sin^2(\theta))}.
            \end{aligned}
            \]
        </div>
        <p>
            By linearizing around the upright position, we obtain a state-space representation for LQR:
        </p>
        <p>
            \[
            \dot{\mathbf{x}} = A\mathbf{x} + B\mathbf{u}, \quad \mathbf{u} = -K\mathbf{x}
            \]
        </p>
    </div>

    <div class="parameters widget">
        <h2>Configure Parameters</h2>
        <div class="container">
            <label for="massCart">Cart Mass (kg): <span id="massCartLabel">1.0</span></label>
            <input type="range" id="massCart" min="0.5" max="5" step="0.1" value="1.0" oninput="updateValues('massCart')">
            <input type="number" id="massCartValue" value="1.0" step="0.1" oninput="updateValues('massCart')">
        </div>
        <div class="container">
            <label for="massPole">Pole Mass (kg): <span id="massPoleLabel">0.1</span></label>
            <input type="range" id="massPole" min="0.05" max="1" step="0.01" value="0.1" oninput="updateValues('massPole')">
            <input type="number" id="massPoleValue" value="0.1" step="0.01" oninput="updateValues('massPole')">
        </div>
        <div class="container">
            <label for="poleLength">Pole Length (m): <span id="poleLengthLabel">0.5</span></label>
            <input type="range" id="poleLength" min="0.2" max="2" step="0.1" value="0.5" oninput="updateValues('poleLength')">
            <input type="number" id="poleLengthValue" value="0.5" step="0.1" oninput="updateValues('poleLength')">
        </div>
        <div class="container">
            <label for="Q">State Cost Matrix (Q):</label>
            <textarea id="Q" rows="4">1, 0, 0, 0; 0, 1, 0, 0; 0, 0, 10, 0; 0, 0, 0, 1</textarea>
        </div>
        <div class="container">
            <label for="R">Control Cost (R):</label>
            <input type="number" id="R" value="1" step="0.1">
        </div>
    </div>

    <div class="results widget">
        <h2>Simulation Results</h2>
        <div id="results">
            <div>Optimal Gain Matrix \(K\): <span id="gainMatrix">--</span></div>
        </div>
    </div>

    <div class="trajectory widget">
        <h2>System Trajectory</h2>
        <svg id="trajectory"></svg>
    </div>

    <script>
        function updateValues(param) {
            const range = document.getElementById(param);
            const number = document.getElementById(param + 'Value');
            const label = document.getElementById(param + 'Label');

            // Sync values
            number.value = range.value;
            label.textContent = range.value;

            // Trigger updates
            computeLQR();
        }

        function computeLQR() {
            const massCart = parseFloat(document.getElementById('massCart').value);
            const massPole = parseFloat(document.getElementById('massPole').value);
            const poleLength = parseFloat(document.getElementById('poleLength').value);

            // Example placeholder for LQR calculation
            const K = `[${(massCart * 2).toFixed(2)}, ${(massPole * 2).toFixed(2)}, ${(poleLength * 3).toFixed(2)}]`;
            document.getElementById('gainMatrix').textContent = K;

            // Update simulation (placeholder)
            renderTrajectory();
        }

        function renderTrajectory() {
            const svg = document.getElementById('trajectory');
            svg.innerHTML = ''; // Clear previous trajectory

            // Placeholder rendering
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', 10);
            line.setAttribute('y1', 290);
            line.setAttribute('x2', 300);
            line.setAttribute('y2', 10);
            line.setAttribute('stroke', 'blue');
            line.setAttribute('stroke-width', 2);
            svg.appendChild(line);
        }

        computeLQR();
    </script>
</body>
</html>
