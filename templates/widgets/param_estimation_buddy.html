{% extends 'base.html' %}
{% load static %}

{% block content %}
<script>
MathJax = {
    tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
    },
    svg: {
        fontCache: 'global'
    }
};
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<div class="param-estimation-container">
    <div class="intro-section">
        <h2>Parameter Estimation Tutorial</h2>
        <p>Interactive demonstration comparing Least Squares and Bayesian approaches to parameter estimation.</p>
        
        <div class="math-section">
            <h3>Key Equations</h3>
            <div class="equations-grid">
                <div class="equation-block">
                    <h4>Least Squares</h4>
                    <p>Minimizing squared error:</p>
                    $$\hat{\theta}_{LS} = \arg\min_{\theta} \sum_{i=1}^n (y_i - f(x_i; \theta))^2$$
                    $$\hat{\theta}_{LS} = (X^TX)^{-1}X^Ty$$
                </div>
                <div class="equation-block">
                    <h4>Bayesian Regression</h4>
                    <p>Posterior distribution:</p>
                    $$p(\theta|D) \propto p(D|\theta)p(\theta)$$
                    $$\theta|D \sim \mathcal{N}(\mu_N, \Sigma_N)$$
                </div>
            </div>
        </div>
    </div>

    <div class="visualization-section">
        <div class="view-controls">
            <h3>View Options</h3>
            <div class="radio-group">
                <input type="radio" id="functionSpace" name="viewType" value="function" checked>
                <label for="functionSpace">Function Space</label>
                <input type="radio" id="weightSpace" name="viewType" value="weight">
                <label for="weightSpace">Weight Space</label>
            </div>
            <div class="checkbox-group">
                <div class="checkbox">
                    <input type="checkbox" id="showLS" checked>
                    <label for="showLS">Show Least Squares</label>
                </div>
                <div class="checkbox">
                    <input type="checkbox" id="showBayes" checked>
                    <label for="showBayes">Show Bayesian</label>
                </div>
                <div class="checkbox">
                    <input type="checkbox" id="showUncertainty" checked>
                    <label for="showUncertainty">Show Uncertainty</label>
                </div>
            </div>
        </div>

        <div class="plot-grid">
            <div class="plot-container">
                <h4>Function Space View</h4>
                <canvas id="functionCanvas" width="600" height="300"></canvas>
            </div>
            <div class="plot-container">
                <h4>Weight Space View</h4>
                <canvas id="weightCanvas" width="600" height="300"></canvas>
            </div>
            <div class="plot-container">
                <h4>Parameter Evolution</h4>
                <canvas id="evolutionCanvas" width="600" height="300"></canvas>
            </div>
            <div class="plot-container">
                <h4>Comparative Results</h4>
                <canvas id="comparisonCanvas" width="600" height="300"></canvas>
            </div>
        </div>

        <div class="parameter-controls">
            <h3>Model Parameters</h3>
            <div class="parameter-grid">
                <div class="parameter">
                    <label for="polynomialOrder">Polynomial Order:</label>
                    <input type="range" id="polynomialOrder" min="1" max="10" value="3">
                    <span class="value">3</span>
                </div>
                <div class="parameter">
                    <label for="priorVariance">Prior Variance:</label>
                    <input type="range" id="priorVariance" min="-2" max="2" step="0.1" value="0">
                    <span class="value">1.0</span>
                </div>
                <div class="parameter">
                    <label for="noiseLevel">Noise Level:</label>
                    <input type="range" id="noiseLevel" min="-4" max="0" step="0.1" value="-2">
                    <span class="value">0.01</span>
                </div>
            </div>
        </div>

        <div class="data-controls">
            <button id="generateData">Generate Random Data</button>
            <button id="clearData">Clear Data</button>
            <button id="optimizeParams">Optimize Parameters</button>
            <div class="example-buttons">
                <button class="example-btn" data-example="linear">Linear</button>
                <button class="example-btn" data-example="quadratic">Quadratic</button>
                <button class="example-btn" data-example="sinusoidal">Sinusoidal</button>
                <button class="example-btn" data-example="outliers">With Outliers</button>
            </div>
        </div>
    </div>
</div>

<style>
.param-estimation-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
    padding: 20px;
    max-width: 1400px;
    margin: 0 auto;
}

.equations-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 15px;
}

.equation-block {
    background: white;
    padding: 15px;
    border-radius: 4px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.visualization-section {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.view-controls {
    margin-bottom: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 4px;
}

.radio-group {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
}

.checkbox-group {
    display: flex;
    gap: 20px;
}

.plot-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin-bottom: 20px;
}

.plot-container {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 4px;
}

.plot-container h4 {
    margin: 0 0 10px 0;
    text-align: center;
}

.parameter-controls {
    margin: 20px 0;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 4px;
}

.parameter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
}

.data-controls {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 20px;
}

.example-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 10px;
}

canvas {
    width: 100%;
    height: 100%;
    border: 1px solid #ddd;
    border-radius: 4px;
    background: white;
}

button {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    background: #007bff;
    color: white;
    cursor: pointer;
    transition: background 0.2s;
}

button:hover {
    background: #0056b3;
}

.example-btn {
    background: #6c757d;
}

.example-btn:hover {
    background: #545b62;
}

input[type="range"] {
    width: 100%;
}

.parameter {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.value {
    font-size: 0.9em;
    color: #666;
}
</style>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
<script src="{% static 'js/parameter_estimation.js' %}"></script>
{% endblock %}
