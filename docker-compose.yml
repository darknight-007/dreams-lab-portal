version: '3.9'

services:
  web:
    build:
      context: .
    env_file:
      - .env
    environment:
      - SECRET_KEY=${SECRET_KEY}
      - DEBUG=${DEBUG:-False}
      - DJANGO_SETTINGS_MODULE=dreams_laboratory.settings
      - TWILIO_ACCOUNT_SID=${TWILIO_ACCOUNT_SID:-}
      - TWILIO_AUTH_TOKEN=${TWILIO_AUTH_TOKEN:-}
      - TWILIO_VERIFY_SERVICE_SID=${TWILIO_VERIFY_SERVICE_SID:-}
      - ALLOWED_HOSTS=${ALLOWED_HOSTS:-localhost,127.0.0.1}
      - VNC_PASSWORD=${VNC_PASSWORD:-}
    volumes:
      - .:/app
      - static_volume:/app/staticfiles
      - media_volume:/app/media
      - ./db.sqlite3:/app/db.sqlite3
      - /var/run/docker.sock:/var/run/docker.sock
      - /home/jdas/openuav2:/app/openuav2
      - /mnt/tesseract-store/trike-backup:/mnt/tesseract-store/trike-backup:ro
    ports:
      - "8080:80"
    command: ["bash", "/app/entrypoint.sh"]
    networks:
      dreamslab:
        ipv4_address: 172.20.0.10
    group_add:
      - ${DOCKER_GROUP_ID:-999}

volumes:
  static_volume:
  media_volume:

networks:
  dreamslab:
    external: true